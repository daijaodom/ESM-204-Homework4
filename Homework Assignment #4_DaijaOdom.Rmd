---
title: 'Homework #4 - Calculating the SCC'
author: "Daija Odom and Devon Rossi"
date: "5/16/2022"
output:
  html_document: default
  word_document: default
---

```{r setup, include=FALSE, message = FALSE, warning = FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)

library(tidyverse)
library(dplyr)
library(janitor)
library(here)
library(kableExtra)

```

```{r}
# Read in the data
damages_data <- read_csv(here("data","damages.csv"))
warming_data <- read_csv(here("data", "warming.csv"))
```

## Question 1. 
Using the damages.csv, estimate a quadratic damage function relating the dollar value of damages to the change in global mean temperature. Estimate a model with zero intercept because damages by construction must equal zero when there is no climate change. Plot your estimated damage function, overlaid with a scatterplot of the underlying data.

```{r}
# Create a linear regression model
damages_data$warming_squared <- damages_data$warming^2
quad_damage_model <- lm(damages ~ warming + warming_squared+ 0, data = damages_data)
# summary(quad_damage_model)

# Define function
quad_function <- function(warming){
  harm <- quad_damage_model$coefficients[1]*warming + quad_damage_model$coefficients[2]*warming^2
  return(harm)
}
```

```{r, fig.cap = "**Figure 1.** Total Annual Damages from climate change fitted with quadratic function and zero intercept"}
# Create a function and scatter plot graph for damages. Use geom_smooth to create quadratic fit.
ggplot(quad_damage_model, aes(warming, damages)) +
  geom_smooth(method = "lm", formula = y ~ x + I(x^2)) +
  geom_point() +
  theme_minimal() +
  labs(x = "Warming (Degrees C)", y = "Annual Total Damages ($)")
```

## Question 2.
Use warming.csv and your estimated damage function to predict damages in each year under the baseline climate and the pulse scenario. Make four plots: 

```{r}
# Create columns of warming with damages for warming baseline, pulse, the difference between no pulse (warming baseline) and pulse, and the difference in damages per ton CO2.

## Warming baseline
warming_data$baseline_damage <- quad_function(warming_data$warming_baseline)

## Pulse
warming_data$pulse_damage <- quad_function(warming_data$warming_pulse)

## Difference
warming_data$difference <- warming_data$pulse_damage - warming_data$baseline_damage

## Difference in damages per ton
warming_data$damage_per_ton_CO2 <-warming_data$difference/35e9

```

**(1) Damages over time without the pulse**
```{r, fig.cap = "**Figure 2.** Damages overtime with no pulse by year"}
## Damages without pulse
ggplot(data = warming_data) +
  geom_point(aes(x = year, y = baseline_damage)) +
  labs(title = "Baseline", 
       x = "Year", 
       y = "Annual Total Damages ($)") + 
  theme_minimal()

```

**(2) Damages over time with the pulse**
```{r, fig.cap = "**Figure 3.** Damages overtime with pulse by year"}
## Damages with pulse
ggplot(data = warming_data) +
  geom_point(aes(x = year, y = pulse_damage)) +
  labs(title = "Pulse Damage", 
       x = "Year",
       y = "Annual Total Damages ($)") +
  theme_minimal()

```

**(3) The difference in damages over time that arrive from pulse**
```{r, fig.cap = "**Figure 4.** Difference in damages over years that arise from pulse"}
## Difference in damages with pulse
ggplot(data = warming_data) +
  geom_point(aes(x = year, y = difference)) +
  labs(title = "Difference in Damages", 
       x = "Year",
       y = "Annual Total Damages ($)") +
  theme_minimal()

```

**(4) The difference in damages over time from the pulse per ton of CO_2_ (you can assume that each ton of the pulse causes the same amount of damage)**
```{r, fig.cap = "**Figure 5.** Difference in damages per ton of CO2 by year"}
## Difference in damages per ton of CO2
ggplot(data = warming_data) +
  geom_point(aes(x = year, y = damage_per_ton_CO2)) +
  labs(title = "Difference in Damages per ton CO2", 
       x = "Year",
       y = "Annual Total Damages ($)") +
  theme_minimal()

```

## Question 3.
The SCC is the present discounted value of the stream of future  damages caused by one additional ton of CO_2_. The Obama Administration used a discount rate of 3% to discount damages. Recently, New York State used a discount rate of 2%. Calculate and make a plot of the SCC (y-axis) against the discount rate (x-axis) for a reasonable range of discount rates. Explain the intuition for how the discount rate affects the SCC. 

```{r}
# Make a function of npv
npv_function <- function(future_damage, year, rate, reference_year) {
  output = future_damage/(1+rate/100)^(year-reference_year)
  return(output)
}

npv_damages_df <- data.frame(year = warming_data$year) %>% 
  mutate(damage_per_ton_CO2 = warming_data$damage_per_ton_CO2,
         discounted_2_percent = npv_function(damage_per_ton_CO2, year, 2, 2022),
         discounted_3_percent = npv_function(damage_per_ton_CO2, year, 3, 2022),
         discounted_4_percent = npv_function(damage_per_ton_CO2, year, 4, 2022),
         discounted_5_percent = npv_function(damage_per_ton_CO2, year, 5, 2022),
         discounted_6_percent = npv_function(damage_per_ton_CO2, year, 6, 2022),
         discounted_7_percent = npv_function(damage_per_ton_CO2, year, 7, 2022),
         discounted_8_percent = npv_function(damage_per_ton_CO2, year, 8, 2022),
         discounted_9_percent = npv_function(damage_per_ton_CO2, year, 9, 2022),
         discounted_10_percent = npv_function(damage_per_ton_CO2, year, 10, 2022)) 

# use that discount 
# summing the npv up to 2100 


```

As the discount rate increases, the net present value (NPV) decreases.
